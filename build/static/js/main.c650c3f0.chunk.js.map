{"version":3,"sources":["socket.js","components/controls.jsx","components/rooms.jsx","components/videochat.jsx","components/chat.jsx","components/RoomInfo.jsx","components/dash.jsx","App.jsx","index.js"],"names":["socket","io","Controls","props","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","handleChange","e","setState","value","target","handleSubmit","preventDefault","state","react_default","a","createElement","className","onSubmit","autoFocus","autofocus","placeholder","onChange","type","onClick","buttonText","Component","Rooms","room","emit","_this2","components_controls","keys","rooms","map","roomid","currentRoomId","changeRoom","key","peerConnectionConfig","iceServers","urls","credential","username","url","VideoChat","gotUserMedia","stream","localStream","localStreamSRC","URL","createObjectURL","socketId","id","on","gotSignal","connections","objectSpread","streams","connectons","count","clients","console","log","dir","forEach","socketListId","RTCPeerConnection","onicecandidate","event","candidate","JSON","stringify","ice","onaddstream","gotRemoteStream","addStream","connection","createOffer","then","description","setLocalDescription","sdp","localDescription","catch","err","from","message","signal","parse","setRemoteDescription","RTCSessionDescription","createAnswer","addIceCandidate","RTCIceCandidate","joinTranslation","leaveTranslation","localVideo","React","createRef","navigator","getUserMedia","video","audio","style","position","right","bottom","autoPlay","src","ref","Chat","messagesBlock","current","scrollTop","scrollHeight","time","Date","toTimeString","slice","components_videochat","currentRoom","messages","msg","userName","join","text","normalizeTime","timestamp","RoomInfo","chatUsers","user","translationUsers","Dash","getChatInfo","info","components_rooms","components_chat","name","sendMessage","components_RoomInfo","App","register","registered","userid","users","joinRoom","isRegistered","joined","concat","push","components_dash","ReactDOM","render","src_App_0","document","getElementById"],"mappings":"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","file":"static/js/main.c650c3f0.chunk.js","sourcesContent":["import io from 'socket.io-client'\r\nconst socket = io()\r\n\r\nexport default socket","import React, { Component } from 'react'\r\nimport './controls.scss'\r\n\r\nclass Controls extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            value: ''\r\n        }\r\n    }\r\n    handleChange = e => {\r\n        this.setState({value: e.target.value})\r\n    }\r\n    handleSubmit = e => {\r\n        e.preventDefault()\r\n        this.props.handleSubmit(this.state.value)\r\n        this.setState({value: ''})\r\n    }\r\n    render() {\r\n        return (\r\n            <div className=\"Controls\">\r\n                <form onSubmit={this.handleSubmit}>\r\n                    <input autoFocus={this.props.autofocus} placeholder={this.props.placeholder} onChange={this.handleChange} value={this.state.value} type=\"text\"/>\r\n                    <a onClick={this.handleSubmit} className=\"button\">{this.props.buttonText}</a>\r\n                </form>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nexport default Controls","import React, { Component } from 'react'\r\nimport Controls from './controls'\r\nimport socket from '../socket.js'\r\nimport './rooms.scss'\r\n\r\nclass Rooms extends Component {\r\n    render() {\r\n        return (\r\n            <div className=\"Rooms\">\r\n                <Controls buttonText=\"Join\" handleSubmit={this.handleSubmit} placeholder=\"Room id\" />\r\n                {Object.keys(this.props.rooms).map(roomid => (\r\n                    <p className={this.props.currentRoomId == roomid ? 'active' : ''} onClick={() => this.props.changeRoom(roomid)} key={roomid}>{roomid}</p>\r\n                ))}\r\n            </div>\r\n        )\r\n    }\r\n    handleSubmit = room => {\r\n        socket.emit('join-room', room)\r\n    }\r\n}\r\n\r\nexport default Rooms","import React, { Component } from 'react'\r\nimport socket from '../socket';\r\nimport './videochat.scss'\r\n\r\nconst peerConnectionConfig = {\r\n    'iceServers': [\r\n        {\r\n            'urls': 'turn:numb.viagenie.ca',\r\n            'credential': 'numbnumb',\r\n            'username': 'mntnscr@gmail.com'\r\n        },\r\n        { url: 'stun:stun.l.google.com:19302' },\r\n        { url: 'stun:stun.services.mozilla.com' },\r\n    ]\r\n}\r\n\r\nclass VideoChat extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            socketId: '',\r\n            localStream: {},\r\n            localStreamSRC: '',\r\n            streams: [],\r\n            connections: []\r\n        }\r\n        this.localVideo = React.createRef()\r\n    }\r\n    gotUserMedia = stream => {\r\n        this.setState({\r\n            localStream: stream,\r\n            localStreamSRC: URL.createObjectURL(stream),\r\n            socketId: socket.id\r\n        })\r\n        socket\r\n            .on('signal', this.gotSignal)\r\n            .on('user-leftTranslation', (id) => {\r\n                if (id == this.state.socketId) {\r\n                    this.setState({\r\n                        connectons: {},\r\n                        streams: {}\r\n                    })\r\n                    return;\r\n                }\r\n                let connections = { ...this.state.connections }\r\n                let streams = { ...this.state.streams }\r\n                delete connections[id]\r\n                delete streams[id]\r\n                this.setState({ connections, streams })\r\n            })\r\n            .on('user-joinedTranslation', (id, count, clients) => {\r\n                console.log(typeof clients, count)\r\n                console.dir(clients)\r\n                clients.forEach(socketListId => {\r\n                    if (!this.state.connections[socketListId]) {\r\n                        let connections = { ...this.state.connections }\r\n                        connections[socketListId] = new RTCPeerConnection(peerConnectionConfig)\r\n                        connections[socketListId].onicecandidate = event => {\r\n                            if (event.candidate != null) {\r\n                                console.log('sending ice')\r\n                                socket.emit('signal', socketListId, JSON.stringify({ 'ice': event.candidate }))\r\n                            }\r\n                        }\r\n                        connections[socketListId].onaddstream = event => {\r\n                            this.gotRemoteStream(event, socketListId)\r\n                        }\r\n                        connections[socketListId].addStream(this.state.localStream)\r\n                        this.setState({ connections })\r\n                    }\r\n                })\r\n                if (count >= 2) {\r\n                    let connection = this.state.connections[id]\r\n                    connection.createOffer().then(description => {\r\n                        connection.setLocalDescription(description).then(() => {\r\n                            socket.emit('signal', id, JSON.stringify({ 'sdp': connection.localDescription }))\r\n                        })\r\n                    })\r\n                        .catch(err => console.log(err))\r\n                }\r\n            })\r\n    }\r\n    componentDidMount() {\r\n        navigator.getUserMedia({\r\n            video: true,\r\n            audio: true\r\n        },\r\n            this.gotUserMedia,\r\n            err => console.log(err)\r\n        )\r\n    }\r\n    gotSignal = (from, message) => {\r\n        let signal = JSON.parse(message)\r\n        if (from == this.state.socketId) return\r\n        let connection = this.state.connections[from]\r\n        if (signal.sdp) {\r\n            connection.setRemoteDescription(new RTCSessionDescription(signal.sdp))\r\n                .then(() => {\r\n                    if (signal.sdp.type == 'offer') {\r\n                        connection.createAnswer().then(description => {\r\n                            connection.setLocalDescription(description).then(() => {\r\n                                socket.emit('signal', from, JSON.stringify({\r\n                                    'sdp': connection.localDescription\r\n                                }))\r\n                            })\r\n                        })\r\n                    }\r\n                })\r\n                .catch(err => console.log)\r\n        }\r\n        if (signal.ice) {\r\n            connection.addIceCandidate(new RTCIceCandidate(signal.ice))\r\n                .catch(err => console.log)\r\n        }\r\n    }\r\n    gotRemoteStream = (event, id) => {\r\n        let streams = { ...this.state.streams }\r\n        streams[id] = URL.createObjectURL(event.stream)\r\n        this.setState({ streams })\r\n    }\r\n    joinTranslation = () => {\r\n        socket.emit('join-translation', this.props.room)\r\n    }\r\n    leaveTranslation = () => {\r\n        socket.emit('leave-translation', this.props.room)\r\n    }\r\n    render() {\r\n        return (\r\n            <div className=\"VideoChat\">\r\n                <div className=\"videos\">\r\n                    <video style={{ position: 'absolute', right: '0px', bottom: '0px' }} autoPlay={true} src={this.state.localStreamSRC} ref={this.localVideo}></video>\r\n                    {Object.keys(this.state.streams).map(stream => (\r\n                        <video autoPlay={true} key={this.state.streams[stream]} src={this.state.streams[stream]} />\r\n                    ))}\r\n                </div>\r\n                <div className=\"control-panel\">\r\n                    <button onClick={this.joinTranslation}>Join</button>\r\n                    <button onClick={this.leaveTranslation}>Leave</button>\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nexport default VideoChat","import React, { Component } from 'react'\r\nimport './chat.scss'\r\nimport VideoChat from './videochat'\r\nimport socket from '../socket'\r\n\r\nclass Chat extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            message: ''\r\n        }\r\n        this.messagesBlock = React.createRef()\r\n    }\r\n    handleChange = e => {\r\n        this.setState({ message: e.target.value })\r\n    }\r\n    handleSubmit = e => {\r\n        e.preventDefault()\r\n        if (this.state.message == '') return\r\n        socket.emit('message', this.props.currentRoomId, this.state.message)\r\n        this.setState({ message: '' })\r\n    }\r\n    componentDidUpdate() {\r\n        this.messagesBlock.current.scrollTop = this.messagesBlock.current.scrollHeight;\r\n    }\r\n    normalizeTime(time) {\r\n        const data = new Date(time)\r\n        return data.toTimeString().slice(0, 9)\r\n    }\r\n    render() {\r\n        return (\r\n            <div className=\"Chat\">\r\n                <div className=\"videochat-wrapper\">\r\n                    <VideoChat room={this.props.currentRoomId} />\r\n                </div>\r\n                <form className=\"controls\" onSubmit={this.handleSubmit}>\r\n                    <input autoFocus={true} placeholder=\"Write a message...\" onChange={this.handleChange} value={this.state.message} type=\"text\" />\r\n                </form>\r\n                <div ref={this.messagesBlock} className=\"messages\">\r\n                    {this.props.currentRoom.messages.map((msg, key) => (\r\n                        <div\r\n                            className={[\"message\", (\r\n                                msg.from == 0 ? 'message__service' : ''\r\n                            ), (\r\n                                    msg.from == this.props.userName ? 'message__self' : ''\r\n                                )].join(' ')} key={key}>\r\n                            <div>\r\n                                {msg.from ? (\r\n                                    msg.from == this.props.userName ? (\r\n                                        <span>{msg.message.text}</span>\r\n                                    ) : (\r\n                                            <div>\r\n                                                <div className=\"message_from\">\r\n                                                    {msg.from}\r\n                                                </div>\r\n                                                <div>\r\n                                                    {msg.message.text}\r\n                                                </div>\r\n                                            </div>\r\n                                        )\r\n                                ) : msg.message.text}\r\n                            </div>\r\n                            <div className=\"timestamp\">\r\n                                <span>\r\n                                    {this.normalizeTime(msg.message.timestamp)}\r\n                                </span>\r\n                            </div>\r\n                        </div>\r\n\r\n                    ))}\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nexport default Chat","import React from 'react'\r\n\r\nfunction RoomInfo(props) {\r\n    return (\r\n        <div className=\"RoomInfo\">\r\n            <div className=\"chatInfo\">\r\n                <h1>Chat users</h1>\r\n                {props.chatUsers.map(user => (\r\n                    <p key={user}>{user}</p>\r\n                ))}\r\n            </div>\r\n            <div className=\"translationInfo\">\r\n                <h1>Translation users</h1>\r\n                {props.translationUsers.map(user => (\r\n                    <p key={user}>{user}</p>\r\n                ))}\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default RoomInfo","import React, {Component} from 'react'\r\nimport Rooms from './rooms'\r\nimport Chat from './chat'\r\nimport './dash.scss'\r\nimport socket from '../socket'\r\nimport RoomInfo from './RoomInfo'\r\n\r\nclass Dash extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            currentRoomId: props.user.id,\r\n            chatUsers: [],\r\n            translationUsers: []\r\n        }\r\n    }\r\n    changeRoom = roomid => {\r\n        if (roomid == this.state.currentRoomId) return;\r\n        this.setState({currentRoomId:roomid})\r\n        this.getChatInfo()\r\n    }\r\n    componentDidMount() {\r\n        socket\r\n        .on('joined', roomid => {\r\n            this.setState({currentRoomId: roomid})\r\n            this.getChatInfo()\r\n        })\r\n        .on('chat-info', info => {\r\n            console.log('Got chat info')\r\n            console.dir(info)\r\n            this.setState({ chatUsers: info.chatUsers, translationUsers: info.translationUsers })\r\n        })\r\n        .on('user-joinedTranslation', this.getChatInfo)\r\n        .on('user-leftTranslation', this.getChatInfo)\r\n        .on('user-joined', this.getChatInfo)\r\n        .on('user-left', this.getChatInfo)\r\n        this.getChatInfo()\r\n    }\r\n    getChatInfo = () => {\r\n        socket.emit('get-chat-info', this.state.currentRoomId)\r\n    }\r\n    render() {\r\n        return (\r\n            <div className=\"Dash\">\r\n                <Rooms changeRoom={this.changeRoom} rooms={this.props.user.rooms} currentRoomId={this.state.currentRoomId}/>\r\n                <Chat userName={this.props.user.name} sendMessage={this.sendMessage} currentRoomId={this.state.currentRoomId} currentRoom={this.props.user.rooms[this.state.currentRoomId]}/>\r\n                <RoomInfo chatUsers={this.state.chatUsers} translationUsers={this.state.translationUsers}/>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nexport default Dash;","import React, {\n  Component\n} from 'react';\nimport './App.css';\nimport socket from './socket.js';\nimport Dash from './components/dash'\nimport Controls from './components/controls'\n\nclass App extends Component {\n  render() {\n    return (\n      <div className=\"App\" > {\n        this.state.isRegistered ?\n          (<Dash user={this.state.user}/>) :\n          (<Controls autofocus={true}\n            placeholder=\"Username\"\n            buttonText=\"Login\"\n            handleSubmit={this.register}\n          />)\n      } </div>)\n  }\n  constructor(props) {\n    super(props)\n    this.state = {\n      isRegistered: false,\n      user: {\n        name: '',\n        rooms: {},\n        id: ''\n      }\n    }\n  }\n  register = name => {\n    socket.emit('register', name)\n  }\n  registered = (userid, username) => {\n    let user = {...this.state.user}\n    user.id = userid\n    user.name = username\n    user.rooms[userid] = {\n      users: [],\n      messages: []\n    }\n    this.joinRoom(userid)\n    this.setState({user, isRegistered: true})\n  }\n  joinRoom = room => {\n    socket.emit('join-room', room)\n  }\n  joined = (room, userid) => {\n    console.log(`I joined ${room}`)\n    let user = {\n      ...this.state.user\n    }\n    if (!user.rooms[room]) user.rooms[room] = {\n      users: [],\n      messages: []\n    }\n    user.rooms[room].users.push(userid)\n    console.dir(user)\n    this.setState({user})\n  }\n  message = (room, from, message) => {\n    console.dir(message)\n    let user = {\n      ...this.state.user\n    }\n    user.rooms[room].messages.push({\n      from,\n      message\n    })\n    this.setState({\n      user\n    })\n  }\n  componentDidMount() {\n    socket\n      .on('message', this.message)\n      .on('registered', this.registered)\n      .on('user-joined', this.joined)\n      .on('error', err => console.log(err))\n  }\n}\n\nexport default App;","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));"],"sourceRoot":""}